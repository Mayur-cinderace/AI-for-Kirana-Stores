<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kirana Stores - Tailwind</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            'poppins': ['Poppins', 'sans-serif'],
          },
          colors: {
            'green-custom': '#28a745',
            'green-light': '#34d399',
          }
        }
      }
    }
  </script>

  <style>
    /* Custom animations and gradients */
    @keyframes float {

      0%,
      100% {
        transform: translateY(0px) rotate(0deg);
      }

      50% {
        transform: translateY(-30px) rotate(10deg);
      }
    }

    .float-1 {
      animation: float 8s ease-in-out infinite;
      animation-delay: 0s;
    }

    .float-2 {
      animation: float 8s ease-in-out infinite;
      animation-delay: 1.5s;
    }

    .float-3 {
      animation: float 8s ease-in-out infinite;
      animation-delay: 3s;
    }

    .float-4 {
      animation: float 8s ease-in-out infinite;
      animation-delay: 4.5s;
    }

    .float-5 {
      animation: float 8s ease-in-out infinite;
      animation-delay: 6s;
    }

    .float-6 {
      animation: float 8s ease-in-out infinite;
      animation-delay: 7.5s;
    }

    .float-7 {
      animation: float 8s ease-in-out infinite;
      animation-delay: 2s;
    }

    .float-8 {
      animation: float 8s ease-in-out infinite;
      animation-delay: 5s;
    }

    .bg-gradient-dark {
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    }

    .bg-gradient-light {
      background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
    }

    .bg-gradient-orange {
      background: linear-gradient(135deg, #28a745, #34d399);
    }

    .bg-gradient-orange-top {
      background: linear-gradient(90deg, #28a745, #34d399);
    }

    /* Date picker styling */
    input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(1);
      cursor: pointer;
    }

    .light input[type="date"]::-webkit-calendar-picker-indicator {
      filter: invert(0);
    }

    /* FIXED: Custom dropdown arrow for select elements */
    .select-wrapper {
      position: relative;
    }

    .select-wrapper::after {
      content: '‚ñº';
      position: absolute;
      top: 50%;
      right: 16px;
      transform: translateY(-50%);
      pointer-events: none;
      color: rgba(255, 255, 255, 0.6);
      font-size: 12px;
      transition: color 0.3s ease;
    }

    .light .select-wrapper::after {
      color: rgba(0, 0, 0, 0.6);
    }

    /* FIXED: Select element styling for dark theme */
    select.input-dark {
      background-image: none;
      padding-right: 45px;
    }

    select.input-dark option {
      background-color: #374151 !important;
      color: #ffffff !important;
      padding: 8px 12px;
    }

    /* FIXED: Select element styling for light theme */
    select.input-light {
      background-image: none;
      padding-right: 45px;
    }

    select.input-light option {
      background-color: #ffffff !important;
      color: #1a1a1a !important;
      padding: 8px 12px;
    }

    /* Navbar fixes */
    .light .nav-link-active {
      background: rgba(0, 0, 0, 0.05) !important;
      color: #1a1a1a !important;
    }

    .light .nav-link-inactive {
      color: rgba(0, 0, 0, 0.7) !important;
    }

    .light .nav-link-inactive:hover {
      background: rgba(0, 0, 0, 0.05) !important;
      color: #1a1a1a !important;
    }

    /* FIXED: Added light theme text colors */
    .light .text-white {
      color: #1a1a1a !important;
    }

    .light .text-white.text-opacity-60 {
      color: rgba(26, 26, 26, 0.6) !important;
    }

    .light .text-white.text-opacity-80 {
      color: rgba(26, 26, 26, 0.8) !important;
    }

    .light input,
    .light select {
      color: #1a1a1a !important;
    }

    /* FIXED: Light theme form styling */
    .light .form-container {
      background-color: rgba(255, 255, 255, 0.95) !important;
      border-color: rgba(0, 0, 0, 0.1) !important;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(0, 0, 0, 0.05) !important;
    }

    .light .input-light {
      background-color: rgba(255, 255, 255, 0.95) !important;
      border-color: rgba(0, 0, 0, 0.15) !important;
      color: #1a1a1a !important;
    }

    .light .input-light:focus {
      background-color: rgba(255, 255, 255, 0.95) !important;
      border-color: #28a745 !important;
      box-shadow: 0 0 0 4px rgba(40, 167, 69, 0.15) !important;
    }

    .light .notification-box {
      background-color: rgba(16, 185, 129, 0.15) !important;
      border-color: #10b981 !important;
    }

    .light .notification-title {
      color: #047857 !important;
    }

    /* FIXED: Placeholder text styling */
    .input-dark::placeholder {
      color: rgba(255, 255, 255, 0.4) !important;
    }

    .input-light::placeholder {
      color: rgba(0, 0, 0, 0.4) !important;
    }
  </style>
</head>

<body class="font-poppins bg-gradient-dark min-h-screen relative overflow-x-hidden m-0 p-0">
  <!-- Background Elements -->
  <div class="absolute top-[10%] left-[8%] opacity-[0.03] text-white text-6xl float-1 pointer-events-none z-[1]">üè™
  </div>
  <div class="absolute top-[15%] right-[12%] opacity-[0.03] text-white text-6xl float-2 pointer-events-none z-[1]">üì¶
  </div>
  <div class="absolute top-[35%] left-[5%] opacity-[0.03] text-white text-6xl float-3 pointer-events-none z-[1]">üõí
  </div>
  <div class="absolute top-[45%] right-[8%] opacity-[0.03] text-white text-6xl float-4 pointer-events-none z-[1]">üí∞
  </div>
  <div class="absolute top-[70%] left-[15%] opacity-[0.03] text-white text-6xl float-5 pointer-events-none z-[1]">üìä
  </div>
  <div class="absolute top-[25%] right-[25%] opacity-[0.03] text-white text-6xl float-6 pointer-events-none z-[1]">üéØ
  </div>
  <div class="absolute top-[60%] left-[35%] opacity-[0.03] text-white text-6xl float-7 pointer-events-none z-[1]">üè∑Ô∏è
  </div>
  <div class="absolute top-[80%] right-[30%] opacity-[0.03] text-white text-6xl float-8 pointer-events-none z-[1]">üì±
  </div>

  <!-- Header -->
  <header
    class="bg-black bg-opacity-80 backdrop-blur-[20px] border-b border-white border-opacity-10 py-6 px-16 fixed top-0 left-0 right-0 z-[100] flex justify-between items-center">
    <div class="flex items-center gap-3 text-2xl font-bold text-white">
      <span class="text-3xl">üè™</span>
      Kirana Stores
    </div>
    <nav class="flex gap-12 items-center">
      <a href="#" onclick="showInventory()"
        class="no-underline text-white text-opacity-70 font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl hover:text-white hover:bg-white hover:bg-opacity-10">Home</a>
      <a href="#"
        class="no-underline text-white text-opacity-70 font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl hover:text-white hover:bg-white hover:bg-opacity-10">About</a>
      <a href="#" id="signupNav"
        class="no-underline text-white font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl bg-white bg-opacity-10 relative after:content-[''] after:absolute after:-bottom-3 after:left-1/2 after:transform after:-translate-x-1/2 after:w-[30px] after:h-[3px] after:bg-green-custom after:rounded-[2px]">Signup</a>
      <a href="#" id="loginNav"
        class="no-underline text-white text-opacity-70 font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl hover:text-white hover:bg-white hover:bg-opacity-10">Login</a>
      <button
        class="bg-white bg-opacity-10 border border-white border-opacity-20 text-white py-3 px-3 rounded-xl cursor-pointer transition-all duration-300 backdrop-blur-[10px] text-xl hover:bg-white hover:bg-opacity-20 hover:scale-105"
        onclick="toggleTheme()">üåô</button>
    </nav>
  </header>

  <!-- Main Content -->
  <main class="flex justify-center items-center min-h-screen py-32 px-16 pb-16 relative z-10">
    <!-- Login Form -->
    <div id="loginForm"
      class="hidden form-container bg-black bg-opacity-85 backdrop-blur-[25px] rounded-3xl py-10 px-16 w-[650px] border border-white border-opacity-10 relative overflow-hidden"
      style="box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1);">
      <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-orange-top"></div>

      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-white mb-2 tracking-tight">Welcome Back</h1>
        <p class="text-white text-opacity-60 text-base font-normal leading-snug">Log in to manage your Kirana Stores
          inventory</p>
      </div>

      <form onsubmit="handleLogin(event)">
        <div class="mb-6">
          <label class="block font-semibold text-white mb-2 text-sm tracking-wide">Mobile Number</label>
          <input type="tel" id="loginMobile"
            class="input-dark w-full py-4 px-5 border-2 border-white border-opacity-15 rounded-2xl text-base bg-white bg-opacity-5 text-white transition-all duration-300 font-poppins font-normal placeholder-white placeholder-opacity-40 focus:outline-none focus:border-green-custom focus:shadow-[0_0_0_4px_rgba(40,167,69,0.15)] focus:bg-white focus:bg-opacity-10"
            placeholder="9876543210" maxlength="10" required>
        </div>

        <div class="mb-6">
          <label class="block font-semibold text-white mb-2 text-sm tracking-wide">Kirana ID</label>
          <input type="number" id="loginKiranaId"
            class="input-dark w-full py-4 px-5 border-2 border-white border-opacity-15 rounded-2xl text-base bg-white bg-opacity-5 text-white transition-all duration-300 font-poppins font-normal placeholder-white placeholder-opacity-40 focus:outline-none focus:border-green-custom focus:shadow-[0_0_0_4px_rgba(40,167,69,0.15)] focus:bg-white focus:bg-opacity-10"
            placeholder="123456" min="100000" max="999999" required>
        </div>

        <div class="mb-6">
          <label class="block font-semibold text-white mb-2 text-sm tracking-wide">Role</label>
          <div class="select-wrapper">
            <select id="loginRole"
              class="input-dark w-full py-4 px-5 border-2 border-white border-opacity-15 rounded-2xl text-base bg-white bg-opacity-5 text-white transition-all duration-300 font-poppins font-normal cursor-pointer appearance-none focus:outline-none focus:border-green-custom focus:shadow-[0_0_0_4px_rgba(40,167,69,0.15)] focus:bg-white focus:bg-opacity-10"
              required>
              <option value="" disabled selected>Select Role</option>
              <option value="user">User</option>
              <option value="retailer">Retailer</option>
            </select>
          </div>
        </div>

        <button type="submit"
          class="w-full bg-gradient-orange text-white border-none py-4 px-8 rounded-2xl text-base font-semibold cursor-pointer transition-all duration-300 mt-4 font-poppins tracking-wide hover:transform hover:-translate-y-1 active:transform active:-translate-y-0.5">Login
          with K-ID</button>
      </form>

      <div class="text-center mt-6 text-white text-opacity-60 text-sm">
        Don't have an account? <a href="#" onclick="showSignup()"
          class="text-green-custom no-underline font-semibold border-b border-transparent transition-all duration-300 hover:border-b-green-custom hover:text-green-light">Sign
          up</a>
      </div>

      <div
        class="notification-box mt-6 py-5 px-5 bg-green-500 bg-opacity-15 border-l-4 border-green-500 rounded-xl flex items-start gap-4">
        <div class="text-green-400 text-xl mt-0.5">üí°</div>
        <div>
          <h4 class="notification-title text-green-400 font-semibold mb-2 text-base">Login Instructions</h4>
          <p id="hint-text" class="text-white text-opacity-80 text-sm leading-6">
            Enter your mobile number, 6-digit Kirana ID, and select your role to access your account.
          </p>
        </div>
      </div>
    </div>

    <!-- Signup Form -->
    <div id="signupForm"
      class="form-container bg-black bg-opacity-85 backdrop-blur-[25px] rounded-3xl py-10 px-16 w-[650px] border border-white border-opacity-10 relative overflow-hidden"
      style="box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1);">
      <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-orange-top"></div>

      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-white mb-2 tracking-tight">Create an Account</h1>
        <p class="text-white text-opacity-60 text-base font-normal leading-snug">Sign up to start managing your Kirana
          Stores inventory</p>
      </div>

      <form onsubmit="handleSignup(event)">
        <div class="mb-6">
          <label class="block font-semibold text-white mb-2 text-sm tracking-wide">Full Name</label>
          <input type="text" id="signupName" name="fullName"
            class="input-dark w-full py-4 px-5 border-2 border-white border-opacity-15 rounded-2xl text-base bg-white bg-opacity-5 text-white transition-all duration-300 font-poppins font-normal placeholder-white placeholder-opacity-40 focus:outline-none focus:border-green-custom focus:shadow-[0_0_0_4px_rgba(40,167,69,0.15)] focus:bg-white focus:bg-opacity-10"
            placeholder="John Doe" required>
        </div>

        <div class="mb-6">
          <label class="block font-semibold text-white mb-2 text-sm tracking-wide">Mobile Number</label>
          <input type="tel" id="signupMobile" name="mobile"
            class="input-dark w-full py-4 px-5 border-2 border-white border-opacity-15 rounded-2xl text-base bg-white bg-opacity-5 text-white transition-all duration-300 font-poppins font-normal placeholder-white placeholder-opacity-40 focus:outline-none focus:border-green-custom focus:shadow-[0_0_0_4px_rgba(40,167,69,0.15)] focus:bg-white focus:bg-opacity-10"
            placeholder="9876543210" maxlength="10" required>
        </div>

        <div class="mb-6">
          <label class="block font-semibold text-white mb-2 text-sm tracking-wide">Date of Birth</label>
          <input type="date" id="signupDOB" name="dob"
            class="input-dark w-full py-4 px-5 border-2 border-white border-opacity-15 rounded-2xl text-base bg-white bg-opacity-5 text-white transition-all duration-300 font-poppins font-normal focus:outline-none focus:border-green-custom focus:shadow-[0_0_0_4px_rgba(40,167,69,0.15)] focus:bg-white focus:bg-opacity-10"
            required>
        </div>

        <div class="mb-6">
          <label class="block font-semibold text-white mb-2 text-sm tracking-wide">Role</label>
          <div class="select-wrapper">
            <select id="signupRole" name="role"
              class="input-dark w-full py-4 px-5 border-2 border-white border-opacity-15 rounded-2xl text-base bg-white bg-opacity-5 text-white transition-all duration-300 font-poppins font-normal cursor-pointer appearance-none focus:outline-none focus:border-green-custom focus:shadow-[0_0_0_4px_rgba(40,167,69,0.15)] focus:bg-white focus:bg-opacity-10"
              required>
              <option value="" disabled selected>Select Role</option>
              <option value="user">User</option>
              <option value="retailer">Retailer</option>
            </select>
          </div>
        </div>

        <button type="submit"
          class="w-full bg-gradient-orange text-white border-none py-4 px-8 rounded-2xl text-base font-semibold cursor-pointer transition-all duration-300 mt-4 font-poppins tracking-wide hover:transform hover:-translate-y-1 active:transform active:-translate-y-0.5">Sign
          up </button>
      </form>

      <div class="text-center mt-6 text-white text-opacity-60 text-sm">
        Already have an account? <a href="#" onclick="showLogin()"
          class="text-green-custom no-underline font-semibold border-b border-transparent transition-all duration-300 hover:border-b-green-custom hover:text-green-light">Log
          in</a>
      </div>

      <div
        class="notification-box mt-6 py-5 px-5 bg-green-500 bg-opacity-15 border-l-4 border-green-500 rounded-xl flex items-start gap-4">
        <div class="text-green-400 text-xl mt-0.5">üí°</div>
        <div>
          <h4 class="notification-title text-green-400 font-semibold mb-2 text-base">Getting Started Tip</h4>
          <p class="text-white text-opacity-80 text-sm leading-6">Sign up with your phone number to create your account.
            You‚Äôll instantly get your Kirana ID after registration..</p>
        </div>
      </div>
    </div>
  </main>

  <script>
    // FIXED: Backend API configuration
    const API_BASE_URL = 'http://localhost:49285/api'; // Updated to match your backend port

    let isDark = true;
    let activeNavId = 'signupNav'; // Track active nav item

    // Theme toggle
    function toggleTheme() {
      isDark = !isDark;
      const body = document.body;
      const toggle = document.querySelector('button[onclick="toggleTheme()"]');
      const header = document.querySelector('header');
      const logo = document.querySelector('.flex.items-center.gap-3');
      const navLinks = document.querySelectorAll('nav a');
      const authContainers = document.querySelectorAll('[id$="Form"]');
      const titles = document.querySelectorAll('h1');
      const subtitles = document.querySelectorAll('p:not(.text-green-400):not(.text-white.text-opacity-80):not(.text-black.text-opacity-80)');
      const labels = document.querySelectorAll('label');
      const inputs = document.querySelectorAll('input, select');
      const switchTexts = document.querySelectorAll('.text-center > .text-white.text-opacity-60, .text-center > .text-black.text-opacity-60');
      const notificationTexts = document.querySelectorAll('.text-white.text-opacity-80, .text-black.text-opacity-80');
      const bgElements = document.querySelectorAll('[class*="float-"]');

      if (isDark) {
        // Dark theme
        body.className = 'font-poppins bg-gradient-dark min-h-screen relative overflow-x-hidden m-0 p-0';
        toggle.innerHTML = 'üåô';

        // Header
        header.className = 'bg-black bg-opacity-80 backdrop-blur-[20px] border-b border-white border-opacity-10 py-6 px-16 fixed top-0 left-0 right-0 z-[100] flex justify-between items-center';
        logo.className = 'flex items-center gap-3 text-2xl font-bold text-white';

        // Navigation links
        navLinks.forEach(link => {
          if (link.id === activeNavId) {
            link.className = 'no-underline text-white font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl bg-white bg-opacity-10 relative after:content-[\'\'] after:absolute after:-bottom-3 after:left-1/2 after:transform after:-translate-x-1/2 after:w-[30px] after:h-[3px] after:bg-green-custom after:rounded-[2px]';
          } else {
            link.className = 'no-underline text-white text-opacity-70 font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl hover:text-white hover:bg-white hover:bg-opacity-10';
          }
        });

        // Theme toggle button
        toggle.className = 'bg-white bg-opacity-10 border border-white border-opacity-20 text-white py-3 px-3 rounded-xl cursor-pointer transition-all duration-300 backdrop-blur-[10px] text-xl hover:bg-white hover:bg-opacity-20 hover:scale-105';

        // Auth containers
        authContainers.forEach(container => {
          container.className = container.className
            .replace('bg-white bg-opacity-95', 'bg-black bg-opacity-85')
            .replace('border-black border-opacity-5', 'border-white border-opacity-10');
          container.style.boxShadow = '0 25px 50px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1)';
        });

        // Titles
        titles.forEach(title => {
          title.className = title.className.replace('text-black', 'text-white');
        });

        // Subtitles
        subtitles.forEach(subtitle => {
          subtitle.className = subtitle.className.replace('text-black text-opacity-60', 'text-white text-opacity-60');
        });

        // Labels
        labels.forEach(label => {
          label.className = label.className.replace('text-black', 'text-white');
        });

        // Inputs and selects - FIXED
        inputs.forEach(input => {
          input.className = 'input-dark w-full py-4 px-5 border-2 border-white border-opacity-15 rounded-2xl text-base bg-white bg-opacity-5 text-white transition-all duration-300 font-poppins font-normal placeholder-white placeholder-opacity-40 cursor-pointer appearance-none focus:outline-none focus:border-green-custom focus:shadow-[0_0_0_4px_rgba(40,167,69,0.15)] focus:bg-white focus:bg-opacity-10';
        });

        // Switch texts
        switchTexts.forEach(switchText => {
          switchText.className = switchText.className.replace('text-black text-opacity-60', 'text-white text-opacity-60');
        });

        // Notification texts
        notificationTexts.forEach(notificationText => {
          notificationText.className = notificationText.className.replace('text-black text-opacity-80', 'text-white text-opacity-80');
        });

        // Background elements
        bgElements.forEach(el => {
          el.className = el.className.replace('text-black opacity-[0.02]', 'text-white opacity-[0.03]');
        });

      } else {
        // Light theme
        body.className = 'font-poppins bg-gradient-light min-h-screen relative overflow-x-hidden m-0 p-0 light';
        toggle.innerHTML = '‚òÄÔ∏è';

        // Header
        header.className = 'bg-white bg-opacity-90 backdrop-blur-[20px] border-b border-black border-opacity-10 py-6 px-16 fixed top-0 left-0 right-0 z-[100] flex justify-between items-center';
        logo.className = 'flex items-center gap-3 text-2xl font-bold text-black';

        // Navigation links
        navLinks.forEach(link => {
          if (link.id === activeNavId) {
            link.className = 'nav-link-active no-underline text-black font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl relative after:content-[\'\'] after:absolute after:-bottom-3 after:left-1/2 after:transform after:-translate-x-1/2 after:w-[30px] after:h-[3px] after:bg-green-custom after:rounded-[2px]';
          } else {
            link.className = 'nav-link-inactive no-underline text-black text-opacity-70 font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl hover:text-black hover:bg-black hover:bg-opacity-5';
          }
        });

        // Theme toggle button
        toggle.className = 'bg-black bg-opacity-5 border border-black border-opacity-10 text-black py-3 px-3 rounded-xl cursor-pointer transition-all duration-300 backdrop-blur-[10px] text-xl hover:bg-black hover:bg-opacity-10 hover:scale-105';

        // Auth containers
        authContainers.forEach(container => {
          container.className = container.className
            .replace('bg-black bg-opacity-85', 'bg-white bg-opacity-95')
            .replace('border-white border-opacity-10', 'border-black border-opacity-5');
          container.style.boxShadow = '0 25px 50px rgba(0, 0, 0, 0.15), 0 0 0 1px rgba(0, 0, 0, 0.05)';
        });

        // Titles
        titles.forEach(title => {
          title.className = title.className.replace('text-white', 'text-black');
        });

        // Subtitles
        subtitles.forEach(subtitle => {
          subtitle.className = subtitle.className.replace('text-white text-opacity-60', 'text-black text-opacity-60');
        });

        // Labels
        labels.forEach(label => {
          label.className = label.className.replace('text-white', 'text-black');
        });

        // Inputs and selects - FIXED
        inputs.forEach(input => {
          input.className = 'input-light w-full py-4 px-5 border-2 border-black border-opacity-15 rounded-2xl text-base bg-white text-black transition-all duration-300 font-poppins font-normal placeholder-black placeholder-opacity-40 cursor-pointer appearance-none focus:outline-none focus:border-green-custom focus:shadow-[0_0_0_4px_rgba(40,167,69,0.15)] focus:bg-gray-50';
        });

        // Switch texts
        switchTexts.forEach(switchText => {
          switchText.className = switchText.className.replace('text-white text-opacity-60', 'text-black text-opacity-60');
        });

        // Notification texts
        notificationTexts.forEach(notificationText => {
          notificationText.className = notificationText.className.replace('text-white text-opacity-80', 'text-black text-opacity-80');
        });

        // Background elements
        bgElements.forEach(el => {
          el.className = el.className.replace('text-white opacity-[0.03]', 'text-black opacity-[0.02]');
        });
      }
    }

    function getTimeBasedHint() {
      const hour = new Date().getHours();
      if (hour >= 5 && hour < 12) {
        // Fixed: Replaced em dash with regular dash
        return "Good Morning! Fresh stock has arrived - check the new deals.";
      } else if (hour >= 12 && hour < 17) {
        return "Good Afternoon! Don't miss the lunchtime discount on snacks.";
      } else if (hour >= 17 && hour < 21) {
        return "Good Evening! Customers love our fresh vegetables after 5 PM.";
      } else {
        return "Night Tip: Stock up now ‚Äî we reopen at 7 AM!";
      }
    }

    // Only set hint for signup form
    const signupHintText = document.querySelector('#signupForm .text-white.text-opacity-80');
    if (signupHintText && signupHintText.textContent.includes('After signing up')) {
      // Keep the existing signup hint
    }

    // Navigation functions
    function showLogin() {
      document.getElementById('signupForm').classList.add('hidden');
      document.getElementById('loginForm').classList.remove('hidden');
      activeNavId = 'loginNav';
      updateNavStyles();
    }

    function showSignup() {
      document.getElementById('loginForm').classList.add('hidden');
      document.getElementById('signupForm').classList.remove('hidden');
      activeNavId = 'signupNav';
      updateNavStyles();
    }

    function updateNavStyles() {
      const signupNav = document.getElementById('signupNav');
      const loginNav = document.getElementById('loginNav');
      const isLight = document.body.classList.contains('light');

      if (isLight) {
        // Light theme
        if (activeNavId === 'signupNav') {
          signupNav.className = 'nav-link-active no-underline text-black font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl relative after:content-[\'\'] after:absolute after:-bottom-3 after:left-1/2 after:transform after:-translate-x-1/2 after:w-[30px] after:h-[3px] after:bg-green-custom after:rounded-[2px]';
          loginNav.className = 'nav-link-inactive no-underline text-black text-opacity-70 font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl hover:text-black hover:bg-black hover:bg-opacity-5';
        } else {
          signupNav.className = 'nav-link-inactive no-underline text-black text-opacity-70 font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl hover:text-black hover:bg-black hover:bg-opacity-5';
          loginNav.className = 'nav-link-active no-underline text-black font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl relative after:content-[\'\'] after:absolute after:-bottom-3 after:left-1/2 after:transform after:-translate-x-1/2 after:w-[30px] after:h-[3px] after:bg-green-custom after:rounded-[2px]';
        }
      } else {
        // Dark theme
        if (activeNavId === 'signupNav') {
          signupNav.className = 'no-underline text-white font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl bg-white bg-opacity-10 relative after:content-[\'\'] after:absolute after:-bottom-3 after:left-1/2 after:transform after:-translate-x-1/2 after:w-[30px] after:h-[3px] after:bg-green-custom after:rounded-[2px]';
          loginNav.className = 'no-underline text-white text-opacity-70 font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl hover:text-white hover:bg-white hover:bg-opacity-10';
        } else {
          signupNav.className = 'no-underline text-white text-opacity-70 font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl hover:text-white hover:bg-white hover:bg-opacity-10';
          loginNav.className = 'no-underline text-white font-medium text-base transition-all duration-300 py-3 px-6 rounded-xl bg-white bg-opacity-10 relative after:content-[\'\'] after:absolute after:-bottom-3 after:left-1/2 after:transform after:-translate-x-1/2 after:w-[30px] after:h-[3px] after:bg-green-custom after:rounded-[2px]';
        }
      }
    }

    function showInventory() {
      // Redirect to inventory page or show inventory form
      document.body.innerHTML = `
        <div class="flex justify-center items-center min-h-screen bg-gradient-dark font-poppins">
          <div class="bg-black bg-opacity-85 backdrop-blur-[25px] py-16 px-16 rounded-3xl text-center border border-white border-opacity-10" style="box-shadow: 0 25px 50px rgba(0,0,0,0.5);">
            <h2 class="text-white mb-6 text-3xl font-semibold">Inventory Management</h2>
            <p class="text-white text-opacity-70 mb-10 text-lg">You have successfully logged in!</p>
            <button onclick="location.reload()" class="bg-gradient-orange text-white border-none py-5 px-10 rounded-2xl cursor-pointer font-poppins text-base font-semibold">Go to Inventory Form</button>
          </div>
        </div>
      `;
    }

    // Form handlers - FIXED with proper API calls
    async function handleLogin(event) {
      event.preventDefault();

      const submitBtn = event.target.querySelector('button[type="submit"]');
      const mobile = document.getElementById('loginMobile').value.trim();
      const kiranaId = document.getElementById('loginKiranaId').value.trim();
      const role = document.getElementById('loginRole').value;

      // Helper for button loading state
      const setBtnLoading = (loading) => {
        if (!submitBtn) return;
        submitBtn.disabled = loading;
        submitBtn.textContent = loading ? 'Verifying...' : 'Login with K-ID';
      };

      try {
        // Validation
        if (!mobile || mobile.length !== 10 || !/^[6-9]\d{9}$/.test(mobile)) {
          throw new Error('Please enter a valid 10-digit mobile number starting with 6, 7, 8, or 9');
        }

        if (!kiranaId || kiranaId.length !== 6 || !/^\d{6}$/.test(kiranaId)) {
          throw new Error('Please enter a valid 6-digit Kirana ID');
        }

        if (!role) {
          throw new Error('Please select a role');
        }

        setBtnLoading(true);

        // Call login API
        const response = await fetch(`${API_BASE_URL}/login`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({
            mobile: mobile,
            kiranaId: parseInt(kiranaId),
            role: role
          })
        });

        const data = await response.json();

        if (!response.ok) {
          throw new Error(data.error || `Login failed (status ${response.status})`);
        }

        // Success
        alert(`Welcome back, ${data.fullName}!\nLogin successful as ${data.role}\nKirana ID: ${data.kiranaId}`);

        // Store user info for the session
        window.currentUser = {
          fullName: data.fullName,
          mobile: mobile,
          kiranaId: data.kiranaId,
          role: data.role
        };

        // Handle redirection based on role
        if (data.role === 'retailer') {
          // For retailers, redirect to inventory.html
          // Use the redirectUrl from backend if available, or fallback to default
          const redirectUrl = data.redirectUrl || 'http://127.0.0.1:8000/inventory.html';

          // Check if we're already on the inventory page
          if (!window.location.href.includes('inventory.html')) {
            setTimeout(() => {
              window.location.href = redirectUrl;
            }, 1000);
          }
        } else if (data.role === 'user') {
          // For users, redirect to try_your_luck.html
          const redirectUrl = data.redirectUrl || 'http://127.0.0.1:8000/try_your_luck.html';

          // Check if we're already on the try_your_luck page
          if (!window.location.href.includes('try_your_luck.html')) {
            setTimeout(() => {
              window.location.href = redirectUrl;
            }, 1000);
          }
        } else {
          // For other roles, show inventory
          setTimeout(() => {
            showInventory();
          }, 1000);
        }

      } catch (error) {
        console.error('Login error:', error);

        // Check if it's a network error
        if (error.message.includes('fetch') || error.name === 'TypeError') {
          alert('Unable to connect to server. Please ensure the backend is running on port 49285.');
        } else {
          alert(error.message || 'Login failed. Please try again.');
        }
      } finally {
        setBtnLoading(false);
      }
    }

    async function handleSignup(event) {
      event.preventDefault();

      // Button (if present) - to prevent double submits
      const submitBtn = event.target.querySelector('button[type="submit"]') || document.querySelector('button[type="submit"]');

      // Get form values
      const name = document.getElementById('signupName').value.trim();
      const mobile = document.getElementById('signupMobile').value.trim();
      const dob = document.getElementById('signupDOB').value;
      const role = document.getElementById('signupRole').value;

      // Helpers
      const setBtnLoading = (loading) => {
        if (!submitBtn) return;
        submitBtn.disabled = loading;
        submitBtn.textContent = loading ? 'Creating account...' : 'Sign up';
      };

      // Basic validation
      try {
        if (!name) throw new Error('Please enter your full name');

        // Stronger Indian mobile validation: 10 digits and starts with 6-9
        if (!/^[6-9]\d{9}$/.test(mobile)) throw new Error('Please enter a valid 10-digit mobile number');

        if (!dob) throw new Error('Please select your date of birth');

        // Age validation (>= 16)
        const birthDate = new Date(dob);
        if (isNaN(birthDate.getTime())) throw new Error('Invalid date of birth');
        const today = new Date();
        let age = today.getFullYear() - birthDate.getFullYear();
        const monthDiff = today.getMonth() - birthDate.getMonth();
        if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) age--;
        if (age < 16) throw new Error('You must be at least 16 years old to register');

        if (!role) throw new Error('Please select a role');

        // Disable button while request is in-flight
        setBtnLoading(true);

        // FIXED: Prepare payload with correct API URL
        const payload = {
          fullName: name,
          mobile,
          role,
          dob // optional; backend can ignore if not needed
        };

        const response = await fetch(`${API_BASE_URL}/signup`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(payload)
        });

        const body = await response.json().catch(() => ({}));

        if (!response.ok) {
          // Try to show server error message, fallback to a generic message
          const serverMsg = body.error || body.message || `Signup failed (status ${response.status})`;
          throw new Error(serverMsg);
        }

        // Success ‚Äî backend returns kiranaId and inserted id
        const kiranaId = body.kiranaId ?? 'N/A';
        alert(`Account created successfully as ${role}!\nKirana ID: ${kiranaId}`);

        // Move to login view
        showLogin();

      } catch (err) {
        console.error('Signup error:', err);
        // Check if it's a network error
        if (err.message.includes('fetch')) {
          alert('Unable to connect to server. Please ensure the backend is running on port 49285.');
        } else {
          alert(err.message || 'Error creating account. Please try again.');
        }
      } finally {
        // Re-enable button
        setBtnLoading(false);
      }
    }

    // Navigation event listeners
    document.getElementById('loginNav').addEventListener('click', (e) => {
      e.preventDefault();
      showLogin();
    });

    document.getElementById('signupNav').addEventListener('click', (e) => {
      e.preventDefault();
      showSignup();
    });

    // Auto-format mobile number
    document.addEventListener('input', (e) => {
      if (e.target.type === 'tel') {
        e.target.value = e.target.value.replace(/\D/g, '').slice(0, 10);
      }
    });

    // Set max date for DOB (today's date)
    document.addEventListener('DOMContentLoaded', () => {
      const dobInput = document.getElementById('signupDOB');
      if (dobInput) {
        const today = new Date();
        const maxDate = today.toISOString().split('T')[0];
        dobInput.setAttribute('max', maxDate);

        // Set a reasonable min date (100 years ago)
        const minDate = new Date(today.getFullYear() - 100, today.getMonth(), today.getDate());
        dobInput.setAttribute('min', minDate.toISOString().split('T')[0]);
      }
    });

    // Test backend connectivity on page load
    window.addEventListener('load', async () => {
      try {
        const response = await fetch(`${API_BASE_URL}/health`);
        if (response.ok) {
          console.log('‚úÖ Backend is connected and running');
        } else {
          console.warn('‚ö†Ô∏è Backend responded but with an error');
        }
      } catch (error) {
        console.error('‚ùå Backend connection failed:', error.message);
        console.log('Make sure your Flask backend is running on port 49285');
      }
    });
  </script>
</body>

</html>